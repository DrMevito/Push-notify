<!DOCTYPE html>
<html>
<head>
  <title>FCM Demo</title>

<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "f834053a-9f37-4e4b-861d-814c1e75efbb",
    });
  });
</script>

  
</head>
<body>
  <h1>Push Notification Test</h1>

  <script type="module">
    // main.js

// Import Firebase functions
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCdNeq3qKvQ1Odjy94wJ1CNtXM00siLUK0",
  authDomain: "mevito-2003.firebaseapp.com",
  projectId: "mevito-2003",
  storageBucket: "mevito-2003.appspot.com",
  messagingSenderId: "202471029560",
  appId: "1:202471029560:web:0101b5c77a2e04c6aa9fcd",
  measurementId: "G-SH3YG65TCJ"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const messaging = getMessaging(app);

// Check browser support
if ('Notification' in window && 'serviceWorker' in navigator) {
  // Ask for permission
  Notification.requestPermission().then(permission => {
    if (permission === 'granted') {
      navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then(registration => {
          console.log("Service Worker registered:", registration);

          getToken(messaging, {
            vapidKey: "BH-ZWrhW3JcCyv0U3m0ZrNJLY_YsXBhaDE9f7ExVoP5g-cUUmhz0cRJxqXwP0I9zQbRtU55Tt4D9bwL7eT3g1iU",
            serviceWorkerRegistration: registration
          }).then((currentToken) => {
            if (currentToken) {
              console.log("FCM Token:", currentToken);
              alert("FCM Token:\n" + currentToken);
            } else {
              console.warn("No registration token available.");
            }
          }).catch((err) => {
            console.error("Error retrieving token:", err);
          });

        }).catch(err => {
          console.error("Service Worker registration failed:", err);
        });
    } else {
      alert("Notifications permission not granted.");
    }
  });
} else {
  alert("Browser does not support Notifications or Service Workers.");
}

// Optional: Handle messages when the page is in foreground
onMessage(messaging, (payload) => {
  console.log('Message received in foreground:', payload);
  alert("Push message:\n" + JSON.stringify(payload.notification));
});

  </script>
</body>
</html>
